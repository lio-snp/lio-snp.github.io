---
interface Props {
  id: string;
  spec: Record<string, unknown>;
  height?: number;
}

const { id, spec, height = 430 } = Astro.props;
---

<div id={id} style={`width:100%; min-height:${height}px;`} data-plotly-spec={JSON.stringify(spec)}></div>

<script type="module" is:inline>
  const nodes = document.querySelectorAll('[data-plotly-spec]');
  if (nodes.length > 0) {
    const Plotly = await import('https://cdn.jsdelivr.net/npm/plotly.js-dist-min@2.35.2/+esm');
    for (const node of nodes) {
      if (node.dataset.plotlyRendered === 'true') continue;
      const raw = node.getAttribute('data-plotly-spec');
      if (!raw) continue;
      const spec = JSON.parse(raw);
      Plotly.default.newPlot(node, spec.data ?? [], spec.layout ?? {}, { responsive: true });
      node.dataset.plotlyRendered = 'true';
    }
  }
</script>
